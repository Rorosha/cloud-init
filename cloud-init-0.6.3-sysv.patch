From 52879823f7043fe9711987e6f725a6d163d8c1df Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?P=C3=A1draig=20Brady?= <P@draigBrady.com>
Date: Wed, 27 Jun 2012 16:18:48 +0100
Subject: [PATCH] Add sysv init scripts

---
 sysv/cloud-config     |   90 +++++++++++++++++++++++++++++++++++++++++++++++
 sysv/cloud-final      |   92 +++++++++++++++++++++++++++++++++++++++++++++++++
 sysv/cloud-init       |   90 +++++++++++++++++++++++++++++++++++++++++++++++
 sysv/cloud-init-local |   90 +++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 362 insertions(+), 0 deletions(-)
 create mode 100755 sysv/cloud-config
 create mode 100755 sysv/cloud-final
 create mode 100755 sysv/cloud-init
 create mode 100755 sysv/cloud-init-local

diff --git a/sysv/cloud-config b/sysv/cloud-config
new file mode 100755
index 0000000..b082409
--- /dev/null
+++ b/sysv/cloud-config
@@ -0,0 +1,90 @@
+#!/bin/sh
+#
+# cloud-config
+#
+# chkconfig:   - 20 80
+# description: Apply the settings specified in cloud-config
+
+### BEGIN INIT INFO
+# Provides: cloud-config
+# Required-Start: $remote_fs $network $syslog cloud-init-local cloud-init
+# Required-Stop: $remote_fs $syslog
+# Default-Stop: 0 1 6
+# Short-Description: Apply the settings specified in cloud-config
+# Description: Apply the settings specified in cloud-config
+### END INIT INFO
+
+. /etc/rc.d/init.d/functions
+
+prog=cloud-init-cfg
+exec="/usr/bin/$prog"
+
+[ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
+
+
+start() {
+    [ -x $exec ] || exit 5
+    echo -n $"Starting $prog: "
+    $prog all config
+    retval=$?
+    echo
+    return $retval
+}
+
+stop() {
+    return
+}
+
+restart() {
+    stop
+    start
+}
+
+reload() {
+    restart
+}
+
+force_reload() {
+    restart
+}
+
+rh_status() {
+    status $prog
+}
+
+rh_status_q() {
+    rh_status >/dev/null 2>&1
+}
+
+
+case "$1" in
+    start)
+        rh_status_q && exit 0
+        $1
+        ;;
+    stop)
+        rh_status_q || exit 0
+        $1
+        ;;
+    restart)
+        $1
+        ;;
+    reload)
+        rh_status_q || exit 7
+        $1
+        ;;
+    force-reload)
+        force_reload
+        ;;
+    status)
+        rh_status
+        ;;
+    condrestart|try-restart)
+        rh_status_q || exit 0
+        restart
+        ;;
+    *)
+        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload}"
+        exit 2
+esac
+exit $?
diff --git a/sysv/cloud-final b/sysv/cloud-final
new file mode 100755
index 0000000..54c0bf8
--- /dev/null
+++ b/sysv/cloud-final
@@ -0,0 +1,92 @@
+#!/bin/sh
+#
+# cloud-final
+#
+# chkconfig:   - 99 01
+# description: Execute cloud user/final scripts
+
+### BEGIN INIT INFO
+# Provides:
+# Required-Start: $remote_fs $network $syslog cloud-config
+# Required-Stop: $remote_fs $syslog
+# Default-Stop: 0 1 6
+# Short-Description: Execute cloud user/final scripts
+# Description: Execute cloud user/final scripts
+### END INIT INFO
+
+. /etc/rc.d/init.d/functions
+
+prog=cloud-init-cfg
+exec="/usr/bin/$prog"
+
+[ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
+
+
+start() {
+    [ -x $exec ] || exit 5
+    echo -n $"Starting $prog: "
+    # TODO: Note this will run before rc.local
+    # which needs to be changed to run after.
+    $prog all final
+    retval=$?
+    echo
+    return $retval
+}
+
+stop() {
+    return
+}
+
+restart() {
+    stop
+    start
+}
+
+reload() {
+    restart
+}
+
+force_reload() {
+    restart
+}
+
+rh_status() {
+    status $prog
+}
+
+rh_status_q() {
+    rh_status >/dev/null 2>&1
+}
+
+
+case "$1" in
+    start)
+        rh_status_q && exit 0
+        $1
+        ;;
+    stop)
+        rh_status_q || exit 0
+        $1
+        ;;
+    restart)
+        $1
+        ;;
+    reload)
+        rh_status_q || exit 7
+        $1
+        ;;
+    force-reload)
+        force_reload
+        ;;
+    status)
+        rh_status
+        ;;
+    condrestart|try-restart)
+        rh_status_q || exit 0
+        restart
+        ;;
+    *)
+        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload}"
+        exit 2
+esac
+exit $?
diff --git a/sysv/cloud-init b/sysv/cloud-init
new file mode 100755
index 0000000..0e08ae1
--- /dev/null
+++ b/sysv/cloud-init
@@ -0,0 +1,90 @@
+#!/bin/sh
+#
+# cloud-init remote
+#
+# chkconfig:   - 20 80
+# description: Initial cloud-init job (metadata service crawler)
+
+### BEGIN INIT INFO
+# Provides: cloud-init
+# Required-Start: $remote_fs $network $syslog cloud-init-local
+# Required-Stop: $remote_fs $syslog
+# Default-Stop: 0 1 6
+# Short-Description: Initial cloud-init job
+# Description: Initial cloud-init job (metadata service crawler)
+### END INIT INFO
+
+. /etc/rc.d/init.d/functions
+
+prog=cloud-init
+exec="/usr/bin/$prog"
+
+[ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
+
+
+start() {
+    [ -x $exec ] || exit 5
+    echo -n $"Starting $prog: "
+    $prog start
+    retval=$?
+    echo
+    return $retval
+}
+
+stop() {
+    return
+}
+
+restart() {
+    stop
+    start
+}
+
+reload() {
+    restart
+}
+
+force_reload() {
+    restart
+}
+
+rh_status() {
+    status $prog
+}
+
+rh_status_q() {
+    rh_status >/dev/null 2>&1
+}
+
+
+case "$1" in
+    start)
+        rh_status_q && exit 0
+        $1
+        ;;
+    stop)
+        rh_status_q || exit 0
+        $1
+        ;;
+    restart)
+        $1
+        ;;
+    reload)
+        rh_status_q || exit 7
+        $1
+        ;;
+    force-reload)
+        force_reload
+        ;;
+    status)
+        rh_status
+        ;;
+    condrestart|try-restart)
+        rh_status_q || exit 0
+        restart
+        ;;
+    *)
+        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload}"
+        exit 2
+esac
+exit $?
diff --git a/sysv/cloud-init-local b/sysv/cloud-init-local
new file mode 100755
index 0000000..cb42ce2
--- /dev/null
+++ b/sysv/cloud-init-local
@@ -0,0 +1,90 @@
+#!/bin/sh
+#
+# cloud-init  local
+#
+# chkconfig:   - 20 80
+# description: Initial cloud-init job (pre-networking)
+
+### BEGIN INIT INFO
+# Provides: cloud-init-local
+# Required-Start: $syslog
+# Required-Stop: $syslog
+# Default-Stop: 0 1 6
+# Short-Description: Initial cloud-init job
+# Description: Initial cloud-init job (pre-networking)
+### END INIT INFO
+
+. /etc/rc.d/init.d/functions
+
+prog=cloud-init
+exec="/usr/bin/$prog"
+
+[ -e /etc/sysconfig/$prog ] && . /etc/sysconfig/$prog
+
+
+start() {
+    [ -x $exec ] || exit 5
+    echo -n $"Starting $prog: "
+    $prog start-local
+    retval=$?
+    echo
+    return $retval
+}
+
+stop() {
+    return
+}
+
+restart() {
+    stop
+    start
+}
+
+reload() {
+    restart
+}
+
+force_reload() {
+    restart
+}
+
+rh_status() {
+    status $prog
+}
+
+rh_status_q() {
+    rh_status >/dev/null 2>&1
+}
+
+
+case "$1" in
+    start)
+        rh_status_q && exit 0
+        $1
+        ;;
+    stop)
+        rh_status_q || exit 0
+        $1
+        ;;
+    restart)
+        $1
+        ;;
+    reload)
+        rh_status_q || exit 7
+        $1
+        ;;
+    force-reload)
+        force_reload
+        ;;
+    status)
+        rh_status
+        ;;
+    condrestart|try-restart)
+        rh_status_q || exit 0
+        restart
+        ;;
+    *)
+        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload}"
+        exit 2
+esac
+exit $?
-- 
1.7.6.4

